

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Decompiler &mdash; SCICompanion 3.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="SCICompanion 3.0 documentation" href="index.html"/>
        <link rel="next" title="Preferences" href="preferences.html"/>
        <link rel="prev" title="Anatomy of an SCI game" href="anatomy.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> SCICompanion
          

          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="views.html">View Editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="pics.html">Pic Editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Script editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="classlibrary.html">The SCI1.1 class library</a></li>
<li class="toctree-l1"><a class="reference internal" href="sci_kernels.html">Kernel Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="sci_compiler.html">The SCI Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="texts.html">Text Editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="messages.html">Message editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="sounds.html">Sound Editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="vocabs.html">Vocabs</a></li>
<li class="toctree-l1"><a class="reference internal" href="fonts.html">Font Editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="cursors.html">Cursor Editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="palettes.html">VGA Palette Editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="audio.html">Digital Audio</a></li>
<li class="toctree-l1"><a class="reference internal" href="outputpane.html">Output Pane</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugger</a></li>
<li class="toctree-l1"><a class="reference internal" href="undo.html">Undo</a></li>
<li class="toctree-l1"><a class="reference internal" href="aspectratio.html">Aspect Ratio</a></li>
<li class="toctree-l1"><a class="reference internal" href="palettecycling.html">Palette cycling</a></li>
<li class="toctree-l1"><a class="reference internal" href="anatomy.html">Anatomy of an SCI game</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Decompiler</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-decompile-dialog">The Decompile dialog</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#script-filenames">Script filenames</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decompiling-a-script">Decompiling a script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#public-procedure-names-and-variable-names">Public procedure names and variable names</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#accuracy">Accuracy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="preferences.html">Preferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="gameversion.html">Game/Interpreter Versions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">SCICompanion</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Decompiler</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/decompiler.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="decompiler">
<h1>Decompiler<a class="headerlink" href="#decompiler" title="Permalink to this headline">¶</a></h1>
<p>With <strong>SCI</strong>Companion you can decompile Sierra games to see how they work. This is a vast
improvement over just disassembling scripts, as it reconstructs something close to the original source
code - including conditional structures like if statements, while loops and more.</p>
<p>Some information can&#8217;t be recovered of course. The names of variables aren&#8217;t in the script resources, but
we can make some guesses based on how they are used, and what values are assigned to them.</p>
<p>Here&#8217;s an example of a decompiled <strong>nextCel</strong> method from Space Quest 4&#8217;s <strong>Cycle</strong> class:</p>
<div class="highlight-python"><div class="highlight"><pre>(method (nextCel)
       ++cycleCnt
       return
           (if (&lt;= cycleCnt (send client:cycleSpeed))
               (send client:cel)
           )(else
               = cycleCnt 0
               (if (&amp; (send client:signal) $1000)
                   (send client:cel)
               )(else
                   + (send client:cel) cycleDir
               )
           )
   )
</pre></div>
</div>
<p>And then the same method simply disassembled:</p>
<div class="highlight-python"><div class="highlight"><pre>   (method (nextCel)
       (asm
           ipToa   cycleCnt
           pTos    cycleCnt
           pushi   #cycleSpeed
           pushi   0
           pToa    client
           send    4
           le?
           bnt     code_002e
           pushi   #cel
           pushi   0
           pToa    client
           send    4
           jmp     code_0056
code_002e: ldi     0
           aTop    cycleCnt
           pushi   #signal
           pushi   0
           pToa    client
           send    4
           push
           ldi     4096
           and
           bnt     code_004b
           pushi   #cel
           pushi   0
           pToa    client
           send    4
           jmp     code_0056
code_004b: pushi   #cel
           pushi   0
           pToa    client
           send    4
           push
           pToa    cycleDir
           add
code_0056: ret
       )
   )
</pre></div>
</div>
<p>You can see how much easier the decompiled code is to understand!</p>
<div class="section" id="the-decompile-dialog">
<h2>The Decompile dialog<a class="headerlink" href="#the-decompile-dialog" title="Permalink to this headline">¶</a></h2>
<p>All decompilation starts with the Decompile dialog, accessed from <em>Script-&gt;Manage Decompilation</em>. This
presents you with a list of scripts in the game, and whether or not there are source code (.sc) or .sco
files for each of them.</p>
<div class="section" id="script-filenames">
<h3>Script filenames<a class="headerlink" href="#script-filenames" title="Permalink to this headline">¶</a></h3>
<p>The first thing you should do when decompiling a game is to generate good filenames for the original script files.
This can be done with the <em>Set Filenames</em> button, which will analyze the script resources and try to generate
a filename based on the contents of the script.</p>
<p>You can rename a script by clicking on it in the script list and pressing F2 (you can also do this from the
scripts tab in the game explorer).</p>
</div>
<div class="section" id="decompiling-a-script">
<h3>Decompiling a script<a class="headerlink" href="#decompiling-a-script" title="Permalink to this headline">¶</a></h3>
<p>You can select one or more scripts on the left (using shift-click), and then press the <em>Decompile</em> button. Decompiling a script can be a fairly
lengthy process, so if you&#8217;re only curious about a few scripts, then just select those. As the decompilation takes place, status updates
are given in the pane on the right.</p>
<p>If you want to decompile the entire game of course, then just select all scripts, click <em>Decompile</em> and sit back. Decompiling a typical
entire Sierra game should take about a minute or so.</p>
<p>When a script is decompiled, we also generate the .sco file for it. This contains the &#8220;public&#8221; information in the script (such as the names of
procedures that it exports) which is used by other scripts.</p>
</div>
<div class="section" id="public-procedure-names-and-variable-names">
<h3>Public procedure names and variable names<a class="headerlink" href="#public-procedure-names-and-variable-names" title="Permalink to this headline">¶</a></h3>
<p><strong>SCI</strong>Companion will try to guess good variable names. For temp and parameter names, you have no control over the the names that are used.</p>
<p>However, for script-wide variables and procedure names, we will place these &#8220;guessed&#8221; names in the .sco file. You can edit these names in the <strong>SCO</strong> pane to
make them more meaningful, and then any script that references that script will pick up those new names when it is decompiled again.</p>
<p>When <strong>SCI</strong>Companion encounters other scripts using a global variable (from script 0, main.sc) that still has the default name (e.g. global30), it will
try to give that variable a name based on its usage. That means that as you decompile more scripts, the names of the global variables in main.sc may change (i.e. improve).</p>
<p>So to get a complete decompile, it is recommended to run the decompilation steps a second time on all files so that they pick up any new
names for global variables (and any names for procedures that you have entered).</p>
</div>
</div>
<div class="section" id="accuracy">
<h2>Accuracy<a class="headerlink" href="#accuracy" title="Permalink to this headline">¶</a></h2>
<p>Decompilation is not a perfect science, and there will be situations where <strong>SCI</strong>Companion is not able to reconstruct the high level language conditional structures.
In that case, the code for a method or procedure will fall back to disassembly (in an <em>asm</em> block). In general, this should only happen for about 2% to at most 5% of the
total code in a game.</p>
<p>There may still be some bugs in the resultant decompiled code, so if you recompile a script and suddenly the game starts behaving strangely, that is a likely suspect. If
you encounter this, please send a bug report. If you understand SCI byte code, you can also compare a method&#8217;s code with its disassembled version (which is much easier to get 100% correct) to see if anything
looks wrong. If you check the <em>Disassembly only</em> box in the Decompile Dialog, this will force <strong>SCI</strong>Companion to fallback to assembly for every method or procedure.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="preferences.html" class="btn btn-neutral float-right" title="Preferences" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="anatomy.html" class="btn btn-neutral" title="Anatomy of an SCI game" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Phil Fortier.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>